{
  "kind": "build_request",
  "title": "Alert and auto-fill demographics when MRN already exists",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "When creating a new case, detect if the entered MRN matches an existing case in the cases list and (1) alert the user and (2) automatically populate MRN, date of birth, patient first name, patient last name, species, breed, and sex from the most recent existing case with that MRN.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "if adding a case with a MRN that already exists in the cases list alert the user and automatically complete the MRN,  date of birth, patient first name, patient last name, species, breed and sex using the data from the previous entry"
        ]
      },
      "acceptanceCriteria": [
        "On the New Case page, entering an MRN that already exists in the fetched cases list triggers a user-visible alert in English (e.g., a toast).",
        "After the duplicate MRN is detected, the CaseForm fields are auto-set to the matched caseâ€™s values for: MRN, date of birth, patient first name, patient last name, species, breed, and sex.",
        "When multiple cases share the same MRN, the form uses the most recent prior entry (define and implement as the case with the greatest arrivalDate; if tied/unavailable, fall back to the greatest id).",
        "The auto-fill/alert behavior only runs for new-case creation (i.e., when CaseForm has no initialData) and does not interfere with editing an existing case.",
        "The alert does not repeatedly fire on every render for the same MRN value (e.g., it should fire once per MRN entry/change)."
      ]
    }
  ],
  "constraints": [
    "Do not edit files under frontend/src/components/ui (compose them only).",
    "Do not modify frontend immutable paths listed in SYSTEM_CONTEXT (e.g., frontend/src/hooks/useInternetIdentity.ts(x), frontend/src/hooks/useActor.ts, frontend/src/main.tsx).",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Do not enforce MRN uniqueness at the backend (no trapping or rejecting creates based on MRN).",
    "Do not change case list sorting, import/export behavior, or existing CRUD flows beyond the MRN duplicate auto-fill behavior in the new case form."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}